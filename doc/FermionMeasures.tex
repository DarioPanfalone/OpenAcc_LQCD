

\section{Measurement of Fermionic observables}

\subsection{Noisy estimators and noise vectors}

Let's take a set of uncorrelated stochastic \emph{real} variables $\eta_i$, 
which  satisfy the property
\begin{equation}
\label{orthonormalization}
 \left\langle \eta_i \eta_j \right\rangle_{noise} = \delta_{i,j} \ ,
\end{equation}
where $ \left\langle \ldots  \right\rangle_{noise}$ represent the average over 
``noise'' fluctuations. \\
Let's assume we have a \emph{noise vector} $\eta$, with components $\eta_i$ 
(where $i$ will label a lattice site), and a determined matrix $A_{i,j}$ (which 
is not stochastic!), then we obtain
\begin{equation}
  \left\langle  \sum_{ij} \eta_i A_{ij} \eta_j  \right\rangle_{noise} =  
\sum_{ij} A_{ij} \delta_{ij}  = \mbox{ Tr } A \ .
\end{equation}
Notice that the sum and the average over noise commute. Let's do another 
exercise now. We want to compute
\begin{equation}
 \left( \mbox{Tr } A \right)^2 \ . 
\end{equation}
It must be remarked that\footnote{
The right hand side of Eq.(\ref{eq_warning}) is exactly what one would obtain 
using only \emph{one} random vector to evaluate $\left(\langle \mbox{Tr} A 
\rangle_{noise}\right)^2$. 
}
\begin{equation}
\label{eq_warning}
\left(\left\langle  \sum_{ij} \eta_i A_{ij} \eta_j  \right\rangle_{noise} 
\right)^2 
\neq  \left\langle \left( \sum_{ij} \eta_i A_{ij} \eta_j \right)^2 
\right\rangle_{noise} \ ,
\end{equation}
indeed
\begin{equation}
 \left\langle \left( \sum_{ij} \eta_i A_{ij} \eta_j \right)^2 
\right\rangle_{noise}  = 
\left\langle \sum_{ijkl} \eta_i A_{ij} \eta_j  \eta_k A_{kl} \eta_l
\right\rangle_{noise} \ .
\end{equation}
First of all, the only terms in the sum which give a nonzero contribution are 
the ones in which $i = j $ and $  k = l $, or $i = k$ and $  j = l$, or $ i = 
l $ and $ j = k$. Moreover, if $i=j=k=l$, we have to take into consideration 
also the value of $\langle \eta_i^4\rangle$ (the \emph{contact term}), so
\begin{equation}
\label{mess_worked_out}
 \left\langle \left( \sum_{ij} \eta_i A_{ij} \eta_j \right)^2 
\right\rangle_{noise}  = 
\sum_{i \neq j} \left[ A_{ii} A_{jj} + A_{ij} A_{ji} + A_{ij} 
A_{ij}\right] + \sum_{i} A^2_{ii} \langle \eta_i^4 \rangle_{noise}
\end{equation}
In order to properly estimate the LHS of Eq.(\ref{eq_warning}), we have to use 
\emph{more than one} random vector. Different \emph{independent} random 
vectors, labelled by greek indices, must satisfy the relation
\begin{equation}
\label{multi_vector}
\left\langle \eta^\alpha_i \eta^\beta_j \right\rangle_{noise} = \delta_{ij} 
\delta^{\alpha\beta} \ .
\end{equation}
Then, if $\alpha \neq \beta$,
\begin{equation}
 \left\langle \sum_{ij} \eta^\alpha_i A_{ij} \eta^\alpha_j  
  \sum_{kl} \eta^\beta_k A_{kl} \eta^\beta_l  
\right\rangle_{noise}  =  \sum_i A_{ii} \sum_j A_{jj}  = \left(\mbox{Tr} A 
\right)^2\ \ ,  
\end{equation}
which is exactly what we want. \\
Notice one could use \emph{complex} noise vectors, satisfying 
\[\left\{\begin{array}{ccc}
\langle \eta^\dagger_i \eta_j \rangle_{noise} & = & \delta_{ij}\\
\langle \eta_i \eta_j \rangle_{noise} &= & 0
\end{array} \right . \ ,
\]
which is implies that the real part and the imaginary part of $\eta$ must 
satisfy a relation like Eq.(\ref{multi_vector}). Then, 
\begin{equation}
\label{mess_worked_out_complex}
 \left\langle \left( \sum_{ij} \eta^\dagger_i A_{ij} \eta_j \right)^2 
\right\rangle_{noise}  = 
\sum_{i \neq j} \left[ A_{ii} A_{jj} + A_{ij} A_{ji} \right] + \sum_{i} 
A^2_{ii} \left\langle \left(\eta^\dagger_i  \eta_i \right)^2 
\right\rangle_{noise} \ , 
\end{equation}
which is not yet what we want. 
\subsection{Errors}
Getting back to the real case, we can see what is the variance\footnote{
The variance of a complex number $ z = x + i y$ should be defined as
\[
 \langle x^2 \rangle + \langle y^2 \rangle - \langle x \rangle ^2 - \langle y 
\rangle^2 = \langle z^\ast z \rangle  - \langle z^\ast \rangle  \langle z 
\rangle 
\]
} of 
our estimator of $\mbox { Tr } A $, that is
\begin{equation}
 \label{trace_estimator}
 \frac{1}{N} \sum^N_{\alpha,ij}  \eta^\alpha_i A_{ij} \eta^\alpha_j \ .
\end{equation}
To calculate this, we need to compute the average of the modulus of its square 
first:
\begin{equation}
 \frac{1}{N^2} \sum^N_{\alpha\beta} \sum_{ij,kl} A_{ij} A^\ast_{kl}
 \left\langle \eta^\alpha_i \eta^\alpha_j  \eta^\beta_k \eta^\beta_l 
\right\rangle_{noise}  \ .
\end{equation}
This is equal to
\begin{equation}
 \frac{1}{N^2} \sum^N_{\alpha \neq \beta} \sum_{ij,kl} A_{ij} A^\ast_{kl}
 \left\langle \eta^\alpha_i \eta^\alpha_j  \eta^\beta_k \eta^\beta_l 
\right\rangle_{noise} +  \frac{1}{N^2} \sum^N_{\alpha} \sum_{ij,kl} 
A_{ij} A^\ast_{kl}
 \left\langle \eta^\alpha_i \eta^\alpha_j  \eta^\alpha_k \eta^\alpha_l 
\right\rangle_{noise}   \ .
\end{equation}
The first part is just related to the square of the trace, because if $\alpha 
\neq \beta$ the $\eta$ vector are independent. The second term instead has been 
already calculated in Eq.(\ref{mess_worked_out}), so we obtain
\begin{equation}
\frac{N(N-1)}{N^2} \left|\mbox{ Tr }  A \right|^2 + \frac{1}{N} \left[
\sum_{i \neq j} \left[ A_{ii} A^\ast_{jj} + A_{ij} A^\ast_{ji} + A_{ij} 
A^\ast_{ij}\right] + \sum_{i} \left|A_{ii}\right|^2 \langle 
\left(\eta_i^\alpha\right)^4 \rangle_{noise} \right]
\end{equation}
In the following, we will assume $\langle 
\left(\eta_i^\alpha\right)^4 \rangle_{noise} = c_4 $ for all $\alpha$ and $i$. 
The terms can be rearranged to give
\begin{equation}
\left|\mbox{ Tr }  A \right|^2 + \frac{1}{N} \left[
\mbox{ Tr } A A^\ast + \mbox{ Tr } A A^\dagger 
+ \sum_{i} \left|A_{ii}\right|^2 \left(c_4 -3 \right) \right]
\end{equation}
In order to obtain the variance of the trace estimator, we have to subtract
\begin{equation}
 \left\langle \frac{1}{N} \sum^N_{\alpha,ij}  \eta^\alpha_i A_{ij} 
\eta^\alpha_j \right\rangle_{noise} ^2 = \left|\mbox{ Tr }  A \right|^2 
\end{equation}
and then we obtain
\begin{equation}
 \epsilon^2 =  \frac{1}{N} \left[
\mbox{ Tr } A A^\ast + \mbox{ Tr } A A^\dagger 
+ \sum_{i} \left|A_{ii}\right|^2 \left(c_4 -3 \right) \right] \ . 
\end{equation}
Notice that, if $\eta_i$ is Gaussian, $ c_4 = 3$, 
while if $\eta_i$ is a stochastic $Z_2$ variable, $ c_4 = 1$. Moreover, for 
any probability distribution, $\langle x^4 \rangle \geq \langle x^2 
\rangle ^2$, and since we fixed $\langle x^2 \rangle = 1$ in 
Eq.(\ref{orthonormalization}), we see that the $Z_2$ choice is the one 
that minimizes the errors.\\ 






\subsection{Chiral condensate}

The chiral condensate for a given quark is defined as 
\begin{equation}
 \langle \bar{\psi}_q \psi_q \rangle = \frac{\partial}{\partial m_q} \log Z
\end{equation}
On the lattice, it is calculated through noisy estimators. 
\begin{equation}
 \langle \bar{\psi}_q \psi_q \rangle  = \textrm{Tr} M^{-1} = \langle \phi 
M_q^{-1} \phi \rangle_{noise} \ , 
\end{equation}
where $M_q$ is the Dirac matrix associated to the 
quark $q$ (thus including the $SU(3)$ gauge links, which are the same for all 
quarks, and the optional $U(1)$ phase field, which may include electromagnetic 
fields and \emph{imaginary} chemical potentials), and $\langle \ldots 
\rangle_{noise}$ means an average on the noise vectors $\phi$. As a necessary 
and sufficient condition for the last equality to hold, the scalar product 
between two different noise vectors $\phi_i$ must satisfy
\begin{equation}
 \langle \phi_i \phi_j \rangle_{noise} = \delta_{ij}
\end{equation}
Given a $Z_2$ noise vector\footnote{It may also be 
gaussian, but it 
seems that $Z_2$ works best.} $\phi$, an estimate of the chiral condensate will 
be
\begin{equation}
 \langle \bar{\psi}_q \psi_q \rangle  = \phi M_q^{-1} \phi \ .
\end{equation}

The issue here is to estimate
\begin{equation}
 \label{problem}
 \chi = M_q^{-1} \phi \ . 
\end{equation}
Notice that the algorithm used in the code to invert a 
matrix (the \emph{conjugate gradient} method) requires the matrix to be 
\emph{Hermitean}. $M_q$ is not, but $M_q^\dagger M_q$ is. Then, the trick will 
be to calculate 
\begin{equation}
\label{trick}
 \chi = \left( M_q^\dagger M_q \right)^{-1} M^\dagger \phi \ . 
\end{equation}
In order to be more concrete, let's say a bit more about the structure of the 
Dirac matrix (let's forget for the sake of my fingers the subscript $q$, we're 
concerned by only a quark species at the time anyway). In the staggered 
formulation (see, for example, Rothe's textbook)
\begin{equation}
\label{dirac_matrix_u}
 M_{i,j} = \sum_{\mu = 1}^4 \left[ U_\mu(i) \delta_{i+\hat{\mu},j}- 
U_\mu^\dagger (i-\hat{\mu}) \delta_{i-\hat{\mu},j} \right] + m\delta_{i,j}
\end{equation}
where $U_\mu$ contains also \emph{all} the $U(1)$ phases you can think of 
(the staggered phases $\eta_\mu$, the imaginary chemical potentials and the 
electromagnetic fields), while $i$ and $j$ are indices for the lattice sites. 
It is very apparent that the first term only connects \emph{even} sites to 
\emph{odd} sites. Symbolically, we can write
\[ M = \left( \begin{array}{cc}
M_{ee} & M_{eo} \\
M_{oe} & M_{oo} 
\end{array}
\right) =
\left( \begin{array}{cc}
m & D_{eo} \\
D_{oe} & m 
\end{array}
\right) \ ,
\]
where the gauge links and $U(1)$ phases are contained in the $D_{eo}$ and 
$D_{oe}$ submatrices. Notice that the matrix  
\[ D = \left( \begin{array}{cc}
0 & D_{eo} \\
D_{oe} & 0 
\end{array}
\right)
\]
is anti Hermitian\footnote{There are two ways to see this: the clever one is to 
notice that $D$ is the lattice discretization of a derivative, and as such must 
be antihermitian. The \emph{poor man} way to see this (or the \emph{pedantic 
man} way to check it) is to use Eq.(\ref{dirac_matrix_u}), noticing that 
\begin{equation}
 \left(D_{eo}\right)_{ij} = - \left(D_{oe}\right)_{ji}^\dagger \ , 
\end{equation}
as it must be.
}. This means that 
\[ M^\dagger M = \left( 
\begin{array}{cc}
m^2 - D_{eo} D_{oe} & 0 \\
0 &   m^2 - D_{oe} D_{eo}
\end{array} 
\right) \ . \]
Notice that the submatrices $m^2 - D_{eo} D_{oe}$ and $m^2 - D_{oe} D_{eo}$ are 
Hermitean. So our ploy shown in Eq.(\ref{trick}) turns into
\[ \left( \begin{array}{c}
\chi_e \\
\chi_o
\end{array} \right)
= \left( 
\begin{array}{cc}
\left[m^2 - D_{eo} D_{oe}\right]^{-1} & 0 \\
0 &   \left[m^2 - D_{oe} D_{eo} \right]^{-1}
\end{array}  
\right) \left( 
\begin{array}{cc}
m   &  -D_{eo} \\
-D_{oe}   & m
\end{array}\right)
\left(
\begin{array}{c}
\phi_e \\
\phi_o
\end{array}
\right) \ ,
\] 
from which we read
\begin{equation}
\chi_e = \left[m^2 - D_{eo} D_{oe}\right]^{-1} \left( m \phi_e - D_{eo} 
\phi_o\right)
\end{equation}
and a similar equation for $\chi_o$. From this reasoning it may look like we 
need to perform two inversions, one to obtain $\chi_e$ and another to obtain 
$\chi_o$. We can avoid the second inversion by making use of the original 
statement of the problem, (Eq.~\ref{problem}), which implies $\phi = M \chi$:
\[
\left( \begin{array}{c}
\phi_e \\
\phi_o
\end{array}
\right)  =   \left( \begin{array}{cc}
m & D_{eo} \\
D_{oe} & m 
\end{array}
\right) \left( 
\begin{array}{c}
 \chi_e \\
 \chi_o
\end{array}
 \right) \ . 
\]
This tells us that $\phi_o = D_{oe} \chi_e + m \chi_o$, which implies
\[
 \chi_o = \frac{1}{m} \left( \phi_o - D_{oe} \chi_e \right) \ . 
\]
Once $\chi_e$ and $\chi_o$ are calculated, our estimate of the chiral 
condensate (for a given quark) will be
\begin{equation}
\langle \bar{\psi} \psi \rangle = \phi_e\chi_e + \phi_o \chi_o  
\end{equation}


\subsection{Nonzero chemical potential on the lattice and the quark number}

Let's for the sake of simplicity limit the present discussion to one quark only. In the 
continuum, in the Euclidean, in the presence of a nonzero chemical potential, we have 
\begin{equation}
 Z = \int DA^E D\bar{\psi}D \psi \exp{\left\{-S_g^E(A^E) - \bar{\psi}\left[ 
\gamma_\nu^E \left( \partial_\nu - i A_\nu^E \right) + m \right]\psi + \mu \bar{\psi} 
\gamma_4 \psi \right\} }.
\end{equation}
This is equivalent to substitute the usual dirac operator with [CONTROLLARE SEGNO DI MU]
\begin{equation}
 M(\mu) = \left[ \gamma_\nu^E \left( \partial_\nu - i A_\nu^E \right) - \mu \gamma_4 
+ m \right]
\end{equation}
Two remarks are in order: 
\begin{enumerate}
 \item The usual Hybrid Montecarlo algorithm relies on the Euclidean action $S^E$ being 
real. The gauge Euclidean action $S_g^E$ being real, this requires the determinant of 
the fermion matrix $M(\mu)$ to be real. A sufficient condition for this, is the 
$\gamma_5$-hermiticity condition\footnote{Of course this relies on the property 
\begin{equation}
 Det(M) = Det(\gamma^5 M \gamma^5) . \nonumber
\end{equation}
}, 
$\gamma_5 M \gamma_5 = M$, which is only true if $\mu$ if zero or \emph{pure 
imaginary}, that is $\mu = i \mu_I$.
 \item The term containing $\mu$ can be reabsorbed in $A_4^E$, once on replaces $A_4^E$ 
with
\begin{equation}
 A_4^E = A_4^E - i \mu \mathbb{1} =  A_4^E + \mu_I \mathbb{1} \ . 
\end{equation}
This means that, if we take $\mu$ pure imaginary, we can interpret it as an additional 
$U(1)$ phase in the Fermion Matrix\footnote{
A little discussion here is in order. The first idea one can have for introducing a 
nonzero chemical potential on the lattice, is to ``naively'' discretize the term
$\bar{\psi}\gamma_4\psi$. Unfortunately, this recipe produces (additional) divergencies 
that cannot be ``renormalized away''}. 
\end{enumerate}
With these observations, the $(i,j)$ element of the $\mu$-dependent staggered Dirac 
operator might be written as 
\begin{equation}
\label{Mmu}
 M_{i,j} = \frac{1}{2a} \sum_\nu \eta_\nu(i) \left[ e^{\mu  a  \delta_{\nu,4}} U_\nu(i) 
\delta_{i+\hat{\nu},j} - 
e^{- \mu a \delta_{\nu,4}} U^\dagger_\nu(j)\delta_{i-\hat{\nu},j} \right]
\end{equation}
where $i$ and $j$ label the lattice sites, $\eta_\nu(i)$ are the staggered phases, and 
$U_\nu(i)$ are the $SU(3)$ gauge links.  Notice that, since in our case $\mu = i 
\mu_I$, 
\begin{equation}
 M_{i,j} = \frac{1}{2a} \sum_\nu \eta_\nu(i) \left[ e^{ i \mu a \delta_{\nu,4}} 
U_\nu(i) \delta_{i+\hat{\nu},j} - 
e^{- i \mu a \delta_{\nu,4} } U^\dagger_\nu(j)\delta_{i-\hat{\nu},j} \right]
\end{equation}



The quark number observable $n_q$ on the lattice can be written as 
\begin{equation}
 n_q = \frac{\partial}{\partial \mu} \log Z = Z^{-1} \int DU e^{-S_g^E} 
\frac{\partial \det M(\mu)}{\partial \mu}.
\end{equation}
Noticing that $\det M(\mu) = \prod_i \lambda_i$, we have\footnote{It is also possible 
to use the classical trick $\det M = e^{\mbox{ Tr} \log M}$ with the same effect.}
\begin{equation}
 \frac{\partial \det M (\mu)}{\partial \mu} = \sum_i\frac{\partial 
\lambda_i}{\partial \mu } \frac{1}{\lambda_i} \prod_j \lambda_j  = \mbox{ Tr } \left( 
\frac{\partial M}{\partial \mu}M^{-1}\right) \det M \ .
\end{equation}
Notice that $\partial M / \partial \mu$, from Eq.(\ref{Mmu}), is
\[
  \frac{\partial M_{i,j}}{\partial \mu} = \frac{1}{2}\eta_4(i) \left[ e^{\mu a } 
U_4(i) \delta_{i+\hat{4},j} + 
e^{- \mu a} U^\dagger_4(j)\delta_{i-\hat{4},j} \right] =
\]
\[
= \frac{1}{2} \eta_4(i) \left[ e^{\mu a } 
U_4(i) \delta_{i+\hat{4},j} + 
e^{- \mu a} U^\dagger_4(j)\delta_{i-\hat{4},j} \right] \ . 
\]
Notice that $\mu a = \frac{\mu}{n_t T}$.



 


